<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-type" content="text/html;charset=UTF-8" />
<title>Networking Worksheet</title>
<meta name="author" content="RAMontante"/>
<meta name="date" content="2017-08-10"/>
<base href="https://montcs.bloomu.edu"/>
<style type="text/css">
@import url("/css/generic.css");
@import url("/css/pagefmt.css");
@import url("/css/w3cvalid.css");

body {
    font-size:12pt;
    width:8.5in;
    margin:0;
    padding:0.50in;
}

h3 { margin-bottom:1ex; margin-top:4ex;padding-top:0.5ex;border-top: 1px solid #ddd; }

h4 { margin-bottom:1ex; }

ol { margin-top:1ex; }
ol li { margin-top:0ex; margin-bottom:3ex; padding-top:4px; border-top:1px dotted #999;}
ul li {margin-top:0.5ex;margin-bottom:1.5ex; padding-top:4px;}

img {
    margin:0;
    padding:0;
    border:1px solid #000;
}

.code,
code {
    padding-left:2px;padding-right:2px;margin-bottom:1.5ex;
    font-family: monospace;
    font-size:100%;
}
div.code {width:25em;page-break-inside:avoid;}

.code, code,
pre {background:#e0e0e0}

div#title {
    float:left;
    font-size: 14pt;
    font-weight: bold;
    margin: 0;
    padding: 0;
    border:1px solid red;
}
div#title p {
    width: 3.45in;
    margin: 0ex 0em 0ex 2em;
    text-indent: -2em;
    padding: 0;
}

div#SigBlock {
    float:left;
    width:3in;height:0.75in;
    vertical-align:top;
    border:1px solid #000;padding:1em;
}

.answerline {
    display:inline-block;
    width:1in;
    border-bottom:1px solid #000;
}

.fancyfont {
    color:#a33;
}

</style>
<script type="text/javascript" src="/js/utilities.js"></script>

</head><body class="">

<div id="content">
<div id="title">
  <p class="">Networking</p>
  <p>VM-setup Worksheet</p>
</div><!-- title -->
<div id="SigBlock" class="HIDE"><span class="">Name:</span></div>
<!-- ==================================================================== -->

<h1>Setting up Virtual Machines &mdash; verify operation</h1>

<img class="floatright width300" src="/VM-LAN/VM-network.0d.svg" alt="two VMs" />

In this worksheet you will verify and check out communications between Linux and Windows VMs and their Internet gateway using Wireshark.

<hr/>

<h2>VMs and Wireshark</h2>
Wireshark is a protocol analyzer and "packet sniffer".
It can record network traffic that it sees, and deconstruct each packet into the
various protocols that make up the packet.
It also performs summary analyses of the traffic on the network, and can save copies of the traffic it sees into disk files.
There are commercial alternatives, but wireshark itself is very powerful and popular with network administrators.
<ol><li>
    Start (or restart) your Linux VM and your Windows VM.

</li><li>
    In Windows, run the command <code class="boxed">ipconfig</code> from a command prompt and verify an IP address for the VM.
    It should be "10.0.2.<strong>x</strong>", where "x" might be 6 or 7.
    <p>
    (If it is "169.254.<span class="fancyfont">anything</span>" then something is wrong and you're not connected to a network.)

</li><li>
    In Linux, run the command <code class="boxed">ifconfig</code> (or the command <code class="boxed">ip addr</code>) from a terminal and verify another IP address for this VM.

</li><li>
    In Linux, start Wireshark: <code class="boxed">sudo wireshark</code>
    <p>
    Ignore the "Lua: Error during loading" dialog box and just click on the "OK" button. 
    </p>

</li><li>
    Double-click on your machine's network interface (probably "enp0s3", or possibly "eno1", or "eth0", or "wlp0s3).
    <p>
    You may start seeing some network traffic, displayed in Wireshark's top pane.
    Some of it is generated by the Windows client, some of it by the Linux client.
    </p>

</li><li>
    Use a new terminal in your Linux VM to run the command <code class="boxed">ping&nbsp;-c&nbsp;3&nbsp;10.0.2.<span class="fancyfont">&lt;Windows-IP-address&gt;</span></code>.
</li><li>
    Run the command <code class="boxed">ping&nbsp;-c&nbsp;3&nbsp;4.2.2.2</code> again.

</li><li>
    <img class="floatright width450" src="/VM-LAN/wireshark.png" alt="wireshark" />
    Isolate the "ping" traffic in the wireshark display by using a <em>display filter</em>.
    Enter a simple filter into the box marked <span style="color:#666">Apply a display filter...</span> (circled in red in the image at right): 
    <code>icmp</code>.
    Then press "Enter" (or click on the blue-and-white arrow).
    <p>
    You should now see only those frames whose protocol is labeled as "ICMP".
    Some have your Linux client's IP address as the source, and are marked as "Echo (ping) request".
    These should be matched by frames with your IP address as the destination, marked as "Echo (ping) reply".
    </p>

</li><li>
    From Windows, run the command <code class="boxed"> ping&nbsp;-n&nbsp;3&nbsp;4.2.2.2</code>.
    Do you see this ping traffic in Wireshark?
</li><li>
    Shut down Wireshark.
    Don't bother to save anything, you don't need it.
</li></ol>

<hr/>

<h2>Nmap tryout</h2>
<img class="floatright width450" src="/VM-LAN/zenmap.png" alt="zenmap" />
Nmap is a versatile tool for scanning hosts on a network.
It can identify the hosts according to operating system in use, and what Layer-4 ports are vulnerable to attack.
Be sure that you have permission to use it on any network or host that you choose to scan!

<ol><li>
    Start "zenmap", a graphical interface to the Nmap program:
<pre class="boxed">sudo zenmap</pre>
</li><li>
    <ol><li>
        The zenmap window has a "Target:" entry box.
        Put in <code class="boxed">10.0.2.0/24</code> as the target &mdash; this specifies all hosts whose IP address starts with "10.0.2".
    </li><li>
        Click the arrow on the right side of the "Profile:" entry box.
        Choose "Quick scan".
    </li><li>
        Click on the "<code class="boxed">Scan</code>" button.
    </li></ol>
</li><li>
    When the scan completes, observe the list of found hosts on the left side of the zenmap window.
</li><li>
    Click on the "Topology" tab.
    <ol><li>
        Click on the "Hosts Viewer" button.
        Expand the window a bit so you can see more.
    </li><li>
        Click on each of the IP addresses, and look over what Nmap found about each of them.
        Can you find the operating system that each host is using?
    </li><li>
        When you're done exploring, close the "Hosts Viewer" window.
    </li></ol>
</li><li>
    Shut down zenmap.
    Don't bother to save anything, you don't need it.
</li></ol>

<h2>
Congratulations!  You've set up your initial VMs.
</h2>
<p>
Now you will "export appliances", which are basically backup copies of your client VMs.
If anything bad happens to them, you can import your appliance to get a fresh copy of the VMs.
You could also copy the appliances to a USB drive and import them into Virtualbox on your personal computer to make a virtual LAN at home.
</p>
<p>
A USB drive is recommended for these steps.
8GB should be enough, 16GB or larger is better.
</p>
<p>
This step will take awhile.
You can put it off until the next class if you wish.
</p>
<ol><li>
    Shut down both VMs.
</li><li>
    In the Oracle VM Virtualbox Manager window, click on:
    <strong>File &rarr; Export Appliance...</strong>
</li><li class="">
    Select your Linux VM.
    Click on "<u>N</u>ext".
</li><li class="">
    In the "Storage settings" window change the file's location to something with sufficient space: either your M: drive, or a big USB flash drive.
    Use a descriptive filename, perhaps "<tt>Linux-VM-backup.ova</tt>".
    Make sure your file name has the extension ".ova", and is in the format "OVF 1.0".
    Click on "<u>N</u>ext".
</li><li class="">
    In the "Appliance settings" window you can add descriptive information if you want, or just accept the default values.
</li><li class="">
    Click on "Export".
    <p>
    This action will take a few minutes.
    </p>
</li><li>
    Back up the other VM
    In the Oracle VM Virtualbox Manager window, click on:
    <strong>File &rarr; Export Appliance...</strong>
</li><li class="">
    Select your Windows VM.
    Click on "<u>N</u>ext".
</li><li class="">
    In the "Storage settings" window change the file's location to something with sufficient space: either your M: drive, or a big USB flash drive.
    Use a descriptive filename, perhaps "<tt>Windows-VM-backup.ova</tt>".
    Make sure your file name has the extension ".ova", and is in the format "OVF 1.0".
    Click on "<u>N</u>ext".
</li><li class="">
    In the "Appliance settings" window you can add descriptive information if you want, or just accept the default values.
</li><li class="">
    Click on "Export".
    <p>
    This action will take a few minutes, probably more than for the Linux VM.
    </p>
</li></ol>

You're (finally) done.

</div><!-- content -->
<script type="text/javascript">ts_validate();</script>
</body></html>
